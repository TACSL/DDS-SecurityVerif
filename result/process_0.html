<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
                      <html>
                    <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
                    <title>ProVerif: process 0</title>
                    <link rel="stylesheet" href="cssproverif.css">
                                                                           </head>
                                                                         <body>
                                                                         <H1>Process 0 (the initial process)</H1>
<a name=occ1 class="occ">{1}</a> <span class="keyword">let</span> <span class="var">PK_CI</span>: <span class="type">PK_t</span> = <span class="fun">pk</span>(<span class="fun">SK_CI</span>) <span class="keyword">in</span><br>
<a name=occ2 class="occ">{2}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="var">PK_CI</span>);<br>
<a name=occ3 class="occ">{3}</a> <span class="keyword">let</span> <span class="var">PK_Perm</span>: <span class="type">PK_t</span> = <span class="fun">pk</span>(<span class="fun">SK_Perm</span>) <span class="keyword">in</span><br>
<a name=occ4 class="occ">{4}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="var">PK_Perm</span>);<br>
<a name=occ5 class="occ">{5}</a> <span class="keyword">new</span> <span class="name">Topic_bd</span>: <span class="type">TopicID_t</span>;<br>
(<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ6 class="occ">{6}</a> <span class="keyword">new</span> <span class="name">GUIDA</span>: <span class="type">GUID_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ7 class="occ">{7}</a> <span class="keyword">new</span> <span class="name">PrivKA</span>: <span class="type">SK_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ8 class="occ">{8}</a> <span class="keyword">let</span> <span class="var">sn</span>: <span class="type">GUID_t</span> = <span class="name">GUIDA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ9 class="occ">{9}</a> <span class="keyword">let</span> <span class="var">Pk</span>: <span class="type">PK_t</span> = <span class="fun">pk</span>(<span class="name">PrivKA</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ10 class="occ">{10}</a> <span class="keyword">let</span> <span class="var">CertA</span>: <span class="type">Cert_t</span> = <span class="fun">sign_cert</span>(<span class="var">sn</span>,<span class="var">Pk</span>,<span class="fun">SN_CI</span>,<span class="fun">SK_CI</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ11 class="occ">{11}</a> <span class="keyword">new</span> <span class="name">DGA</span>: <span class="type">DomainGovernance_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ12 class="occ">{12}</a> <span class="keyword">new</span> <span class="name">PPA</span>: <span class="type">ParticipantPermission_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ13 class="occ">{13}</a> <span class="keyword">new</span> <span class="name">QoSA</span>: <span class="type">Qos_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ14 class="occ">{14}</a> <span class="keyword">let</span> <span class="var">sn_1</span>: <span class="type">GUID_t</span> = <span class="name">GUIDA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ15 class="occ">{15}</a> <span class="keyword">let</span> <span class="var">DG</span>: <span class="type">DomainGovernance_t</span> = <span class="name">DGA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ16 class="occ">{16}</a> <span class="keyword">let</span> <span class="var">PP</span>: <span class="type">ParticipantPermission_t</span> = <span class="name">PPA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ17 class="occ">{17}</a> <span class="keyword">let</span> <span class="var">PermA</span>: <span class="type">PermDoc_t</span> = <span class="fun">sign_perm</span>(<span class="var">sn_1</span>,<span class="var">DG</span>,<span class="var">PP</span>,<span class="fun">SK_Perm</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ18 class="occ">{18}</a> <span class="keyword">let</span> <span class="var">DHAlgoA</span>: <span class="type">Algo_t</span> = <span class="fun">make_algo</span>(<span class="fun">ID_G</span>,<span class="fun">DH_RSA</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ19 class="occ">{19}</a> <span class="keyword">!</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ20 class="occ">{20}</a> <span class="keyword">let</span> <span class="var">GUIDA_1</span>: <span class="type">GUID_t</span> = <span class="name">GUIDA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ21 class="occ">{21}</a> <span class="keyword">let</span> <span class="var">PrivK_A</span>: <span class="type">SK_t</span> = <span class="name">PrivKA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ22 class="occ">{22}</a> <span class="keyword">let</span> <span class="var">HashAlgoA</span>: <span class="type">Hash_alg_t</span> = <span class="fun">SHA256</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ23 class="occ">{23}</a> <span class="keyword">let</span> <span class="var">QoSA_1</span>: <span class="type">Qos_t</span> = <span class="name">QoSA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ24 class="occ">{24}</a> <span class="keyword">let</span> <span class="var">AeadAlgoA</span>: <span class="type">Aead_alg_t</span> = <span class="fun">AES_GCM_128</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ25 class="occ">{25}</a> <span class="keyword">let</span> <span class="var">Topic_bd_1</span>: <span class="type">TopicID_t</span> = <span class="name">Topic_bd</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ26 class="occ">{26}</a> <span class="keyword">let</span> <span class="var">PdataA</span>: <span class="type">Pdata_t</span> = <span class="fun">participant_data</span>(<span class="var">GUIDA_1</span>,<span class="var">Topic_bd_1</span>,<span class="var">QoSA_1</span>,<span class="fun">discoveryRegister</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ27 class="occ">{27}</a> <span class="keyword">out</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">GUIDA_1</span>,<span class="var">PdataA</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ28 class="occ">{28}</a> <span class="keyword">in</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">PdataB</span>: <span class="type">Pdata_t</span>,=<span class="fun">discoveredParticipant</span>,=<span class="var">PdataA</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ29 class="occ">{29}</a> <span class="keyword">event</span> <span class="fun">A_discover</span>(<span class="var">PdataB</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ30 class="occ">{30}</a> <span class="keyword">let</span> <span class="fun">make_algo</span>(<span class="var">g</span>: <span class="type">group_t</span>,<span class="var">algoName</span>: <span class="type">AlgoName_t</span>) = <span class="var">DHAlgoA</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ31 class="occ">{31}</a> <span class="keyword">new</span> <span class="name">ChallengeA</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ32 class="occ">{32}</a> <span class="keyword">new</span> <span class="name">s</span>[]: <span class="type">Seed_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ33 class="occ">{33}</a> <span class="keyword">let</span> <span class="var">gx</span>: <span class="type">element_t</span> = <span class="fun">dh_pub</span>(<span class="var">g</span>,<span class="fun">dh_k</span>(<span class="name">s</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ34 class="occ">{34}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">x</span>: <span class="type">bitstring</span>,<span class="var">gx_DHA</span>: <span class="type">element_t</span>) = <span class="fun"></span>(<span class="fun">dh_k</span>(<span class="name">s</span>),<span class="var">gx</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ35 class="occ">{35}</a> <span class="keyword">let</span> <span class="var">CA</span>: <span class="type">Clist_t</span> = <span class="fun">make_C_list</span>(<span class="var">CertA</span>,<span class="var">PermA</span>,<span class="var">PdataA</span>,<span class="var">DHAlgoA</span>,<span class="var">HashAlgoA</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ36 class="occ">{36}</a> <span class="keyword">let</span> <span class="var">hash_CA</span>: <span class="type">bitstring</span> = <span class="fun">hash</span>(<span class="var">HashAlgoA</span>,<span class="fun">Clist2bit</span>(<span class="var">CA</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ37 class="occ">{37}</a> <span class="keyword">event</span> <span class="fun">A_0</span>(<span class="var">GUIDA_1</span>,<span class="var">CA</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>,<span class="var">PdataB</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ38 class="occ">{38}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">CA</span>,<span class="var">hash_CA</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ39 class="occ">{39}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">CB</span>: <span class="type">Clist_t</span>,<span class="var">hash_CB</span>: <span class="type">bitstring</span>,=<span class="name">ChallengeA</span>,<span class="var">ChallengeB</span>: <span class="type">bitstring</span>,<span class="var">gy_DHB</span>: <span class="type">element_t</span>,=<span class="var">hash_CA</span>,=<span class="var">gx_DHA</span>,<span class="var">sigB</span>: <span class="type">Sig_t</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ40 class="occ">{40}</a> <span class="keyword">let</span> <span class="fun">make_C_list</span>(<span class="var">CertB</span>: <span class="type">Cert_t</span>,<span class="var">PermB</span>: <span class="type">PermDoc_t</span>,=<span class="var">PdataB</span>,=<span class="var">DHAlgoA</span>,=<span class="var">HashAlgoA</span>) = <span class="var">CB</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ41 class="occ">{41}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">GUIDB</span>: <span class="type">GUID_t</span>,<span class="var">PkB</span>: <span class="type">PK_t</span>,=<span class="fun">SN_CI</span>) = <span class="fun">check_cert</span>(<span class="var">CertB</span>,<span class="var">PK_CI</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ42 class="occ">{42}</a> <span class="keyword">if</span> <span class="fun">verify</span>(<span class="var">PkB</span>,<span class="fun"></span>(<span class="fun">hash</span>(<span class="var">HashAlgoA</span>,<span class="fun">Clist2bit</span>(<span class="var">CB</span>)),<span class="var">ChallengeB</span>,<span class="var">gy_DHB</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>,<span class="var">hash_CA</span>),<span class="var">sigB</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ43 class="occ">{43}</a> <span class="keyword">event</span> <span class="fun">endAtoB</span>(<span class="var">GUIDB</span>,<span class="var">CertB</span>,<span class="name">ChallengeA</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ44 class="occ">{44}</a> <span class="keyword">let</span> <span class="var">gxy_SharedSecret</span>: <span class="type">element_t</span> = <span class="fun">dh_exp</span>(<span class="var">gy_DHB</span>,<span class="var">x</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ45 class="occ">{45}</a> <span class="keyword">let</span> <span class="var">SharedSecret</span>: <span class="type">bitstring</span> = <span class="fun">e2b</span>(<span class="var">gxy_SharedSecret</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ46 class="occ">{46}</a> <span class="keyword">let</span> <span class="var">sigA</span>: <span class="type">Sig_t</span> = <span class="fun">sign</span>(<span class="var">PrivK_A</span>,<span class="fun"></span>(<span class="var">hash_CA</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>,<span class="var">ChallengeB</span>,<span class="var">gy_DHB</span>,<span class="var">hash_CB</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ47 class="occ">{47}</a> <span class="keyword">event</span> <span class="fun">beginBtoA</span>(<span class="var">GUIDA_1</span>,<span class="var">CertA</span>,<span class="var">ChallengeB</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ48 class="occ">{48}</a> <span class="keyword">event</span> <span class="fun">A_1</span>(<span class="var">GUIDA_1</span>,<span class="var">CA</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>,<span class="var">GUIDB</span>,<span class="var">CB</span>,<span class="var">ChallengeB</span>,<span class="var">gy_DHB</span>,<span class="var">SharedSecret</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ49 class="occ">{49}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">hash_CA</span>,<span class="fun">hash</span>(<span class="var">HashAlgoA</span>,<span class="fun">Clist2bit</span>(<span class="var">CB</span>)),<span class="var">gx_DHA</span>,<span class="var">gy_DHB</span>,<span class="name">ChallengeA</span>,<span class="var">ChallengeB</span>,<span class="var">sigA</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ50 class="occ">{50}</a> <span class="keyword">in</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">PermB_x</span>: <span class="type">PermDoc_t</span>,=<span class="fun">TopicDiscovered</span>,<span class="var">Topic</span>: <span class="type">TopicID_t</span>,=<span class="var">PdataB</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ51 class="occ">{51}</a> <span class="keyword">if</span> (<span class="var">PermB_x</span> <span class="fun">=</span> <span class="var">PermB</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ52 class="occ">{52}</a> <span class="keyword">let</span> <span class="fun"></span>(=<span class="var">GUIDB</span>,<span class="var">DGB</span>: <span class="type">DomainGovernance_t</span>,<span class="var">PPB</span>: <span class="type">ParticipantPermission_t</span>) = <span class="fun">check_perm</span>(<span class="var">PermB</span>,<span class="var">PK_Perm</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ53 class="occ">{53}</a> <span class="keyword">event</span> <span class="fun">PERM_CHECK</span>(<span class="var">GUIDB</span>,<span class="var">PermB</span>,<span class="var">Topic</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ54 class="occ">{54}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">GUIDA_1</span>,<span class="fun">PermissionChecked</span>,<span class="var">GUIDB</span>,<span class="var">Topic</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ55 class="occ">{55}</a> <span class="keyword">let</span> <span class="var">KeyMaterial</span>: <span class="type">KeyMaterial_t</span> = <span class="fun">KDF</span>(<span class="var">SharedSecret</span>,<span class="name">ChallengeA</span>,<span class="var">ChallengeB</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ56 class="occ">{56}</a> <span class="keyword">let</span> <span class="var">CryptoToken</span>: <span class="type">CryptoToken_t</span> = <span class="fun">encCryptoToken</span>(<span class="var">KeyMaterial</span>,<span class="var">DHAlgoA</span>,<span class="var">HashAlgoA</span>,<span class="var">AeadAlgoA</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ57 class="occ">{57}</a> <span class="keyword">event</span> <span class="fun">A_2</span>(<span class="var">GUIDA_1</span>,<span class="var">CA</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>,<span class="var">GUIDB</span>,<span class="var">CB</span>,<span class="var">ChallengeB</span>,<span class="var">gy_DHB</span>,<span class="var">SharedSecret</span>,<span class="var">KeyMaterial</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ58 class="occ">{58}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="var">CryptoToken</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ59 class="occ">{59}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">cryptoHeader</span>: <span class="type">CryptoHeader_t</span>,<span class="var">applicationData_x</span>: <span class="type">bitstring</span>,<span class="var">applicationDataMAC</span>: <span class="type">bitstring</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ60 class="occ">{60}</a> <span class="keyword">let</span> <span class="fun">makeCryptoHeader</span>(<span class="var">sessionID</span>: <span class="type">bitstring</span>,<span class="var">IV</span>: <span class="type">bitstring</span>) = <span class="var">cryptoHeader</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ61 class="occ">{61}</a> <span class="keyword">let</span> <span class="var">sessionKey</span>: <span class="type">bitstring</span> = <span class="fun">hmac</span>(<span class="var">HashAlgoA</span>,<span class="fun">b2mk</span>(<span class="fun">km2b</span>(<span class="var">KeyMaterial</span>)),<span class="fun"></span>(<span class="var">sessionID</span>,<span class="var">KeyMaterial</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ62 class="occ">{62}</a> <span class="keyword">if</span> <span class="fun">aead_mac_check</span>(<span class="var">AeadAlgoA</span>,<span class="fun">b2ae</span>(<span class="var">sessionKey</span>),<span class="var">IV</span>,<span class="fun">chtob</span>(<span class="var">cryptoHeader</span>),<span class="var">applicationData_x</span>,<span class="var">applicationDataMAC</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ63 class="occ">{63}</a> <span class="keyword">event</span> <span class="fun">A_3</span>(<span class="var">GUIDB</span>,<span class="var">GUIDA_1</span>,<span class="var">applicationData_x</span>,<span class="var">cryptoHeader</span>,<span class="var">sessionKey</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ64 class="occ">{64}</a> <span class="keyword">event</span> <span class="fun">ENC_COMMUNICATION</span>(<span class="var">GUIDA_1</span>,<span class="var">CA</span>,<span class="name">ChallengeA</span>,<span class="var">gx_DHA</span>,<span class="var">GUIDB</span>,<span class="var">CB</span>,<span class="var">ChallengeB</span>,<span class="var">gy_DHB</span>,<span class="var">SharedSecret</span>,<span class="var">KeyMaterial</span>,<span class="var">cryptoHeader</span>,<span class="var">sessionKey</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ65 class="occ">{65}</a> <span class="keyword">new</span> <span class="name">sessionID_new</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ66 class="occ">{66}</a> <span class="keyword">new</span> <span class="name">IV_new</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ67 class="occ">{67}</a> <span class="keyword">let</span> <span class="var">cryptoHeader_new</span>: <span class="type">CryptoHeader_t</span> = <span class="fun">makeCryptoHeader</span>(<span class="name">sessionID_new</span>,<span class="name">IV_new</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ68 class="occ">{68}</a> <span class="keyword">let</span> <span class="var">sessionKey_new</span>: <span class="type">bitstring</span> = <span class="fun">hmac</span>(<span class="var">HashAlgoA</span>,<span class="fun">b2mk</span>(<span class="fun">km2b</span>(<span class="var">KeyMaterial</span>)),<span class="fun"></span>(<span class="name">sessionID_new</span>,<span class="var">KeyMaterial</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ69 class="occ">{69}</a> <span class="keyword">new</span> <span class="name">applicationData_new</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ70 class="occ">{70}</a> <span class="keyword">event</span> <span class="fun">KEY_UPDATE_begin</span>(<span class="var">GUIDA_1</span>,<span class="var">GUIDB</span>,<span class="var">cryptoHeader_new</span>,<span class="var">sessionKey_new</span>,<span class="name">applicationData_new</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ71 class="occ">{71}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">cryptoHeader_new</span>,<span class="name">applicationData_new</span>,<span class="fun">aead_mac</span>(<span class="var">AeadAlgoA</span>,<span class="fun">b2ae</span>(<span class="var">sessionKey_new</span>),<span class="var">IV</span>,<span class="fun">chtob</span>(<span class="var">cryptoHeader_new</span>),<span class="name">applicationData_new</span>)));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ72 class="occ">{72}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="name">finishA</span>)<br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ73 class="occ">{73}</a> <span class="keyword">new</span> <span class="name">GUIDB_1</span>: <span class="type">GUID_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ74 class="occ">{74}</a> <span class="keyword">new</span> <span class="name">PrivKB</span>: <span class="type">SK_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ75 class="occ">{75}</a> <span class="keyword">let</span> <span class="var">sn_2</span>: <span class="type">GUID_t</span> = <span class="name">GUIDB_1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ76 class="occ">{76}</a> <span class="keyword">let</span> <span class="var">Pk_1</span>: <span class="type">PK_t</span> = <span class="fun">pk</span>(<span class="name">PrivKB</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ77 class="occ">{77}</a> <span class="keyword">let</span> <span class="var">CertB_1</span>: <span class="type">Cert_t</span> = <span class="fun">sign_cert</span>(<span class="var">sn_2</span>,<span class="var">Pk_1</span>,<span class="fun">SN_CI</span>,<span class="fun">SK_CI</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ78 class="occ">{78}</a> <span class="keyword">new</span> <span class="name">DGB_1</span>: <span class="type">DomainGovernance_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ79 class="occ">{79}</a> <span class="keyword">new</span> <span class="name">PPB_1</span>: <span class="type">ParticipantPermission_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ80 class="occ">{80}</a> <span class="keyword">new</span> <span class="name">QosB</span>: <span class="type">Qos_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ81 class="occ">{81}</a> <span class="keyword">let</span> <span class="var">sn_3</span>: <span class="type">GUID_t</span> = <span class="name">GUIDB_1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ82 class="occ">{82}</a> <span class="keyword">let</span> <span class="var">DG_1</span>: <span class="type">DomainGovernance_t</span> = <span class="name">DGB_1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ83 class="occ">{83}</a> <span class="keyword">let</span> <span class="var">PP_1</span>: <span class="type">ParticipantPermission_t</span> = <span class="name">PPB_1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ84 class="occ">{84}</a> <span class="keyword">let</span> <span class="var">PermB_1</span>: <span class="type">PermDoc_t</span> = <span class="fun">sign_perm</span>(<span class="var">sn_3</span>,<span class="var">DG_1</span>,<span class="var">PP_1</span>,<span class="fun">SK_Perm</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ85 class="occ">{85}</a> <span class="keyword">let</span> <span class="var">DHAlgoB</span>: <span class="type">Algo_t</span> = <span class="fun">make_algo</span>(<span class="fun">ID_G</span>,<span class="fun">DH_RSA</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ86 class="occ">{86}</a> <span class="keyword">!</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ87 class="occ">{87}</a> <span class="keyword">let</span> <span class="var">GUIDB_2</span>: <span class="type">GUID_t</span> = <span class="name">GUIDB_1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ88 class="occ">{88}</a> <span class="keyword">let</span> <span class="var">PrivK_B</span>: <span class="type">SK_t</span> = <span class="name">PrivKB</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ89 class="occ">{89}</a> <span class="keyword">let</span> <span class="var">HashAlgoB</span>: <span class="type">Hash_alg_t</span> = <span class="fun">SHA256</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ90 class="occ">{90}</a> <span class="keyword">let</span> <span class="var">QosB_1</span>: <span class="type">Qos_t</span> = <span class="name">QosB</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ91 class="occ">{91}</a> <span class="keyword">let</span> <span class="var">AeadAlgoB</span>: <span class="type">Aead_alg_t</span> = <span class="fun">AES_GCM_128</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ92 class="occ">{92}</a> <span class="keyword">let</span> <span class="var">Topic_bd_2</span>: <span class="type">TopicID_t</span> = <span class="name">Topic_bd</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ93 class="occ">{93}</a> <span class="keyword">let</span> <span class="var">PdataB_1</span>: <span class="type">Pdata_t</span> = <span class="fun">participant_data</span>(<span class="var">GUIDB_2</span>,<span class="var">Topic_bd_2</span>,<span class="var">QosB_1</span>,<span class="fun">discoveryRegister</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ94 class="occ">{94}</a> <span class="keyword">event</span> <span class="fun">B_discover</span>(<span class="var">PdataB_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ95 class="occ">{95}</a> <span class="keyword">out</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">GUIDB_2</span>,<span class="var">PdataB_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ96 class="occ">{96}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">CA_1</span>: <span class="type">Clist_t</span>,<span class="var">hash_CA_1</span>: <span class="type">bitstring</span>,<span class="var">ChallengeA_1</span>: <span class="type">bitstring</span>,<span class="var">gx_DHA_1</span>: <span class="type">element_t</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ97 class="occ">{97}</a> <span class="keyword">let</span> <span class="fun">make_C_list</span>(<span class="var">CertA_1</span>: <span class="type">Cert_t</span>,<span class="var">PermA_1</span>: <span class="type">PermDoc_t</span>,<span class="var">PdataA_1</span>: <span class="type">Pdata_t</span>,=<span class="var">DHAlgoB</span>,=<span class="var">HashAlgoB</span>) = <span class="var">CA_1</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ98 class="occ">{98}</a> <span class="keyword">let</span> <span class="fun">make_algo</span>(<span class="var">g_1</span>: <span class="type">group_t</span>,<span class="var">algoName_1</span>: <span class="type">AlgoName_t</span>) = <span class="var">DHAlgoB</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ99 class="occ">{99}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">GUIDA_2</span>: <span class="type">GUID_t</span>,<span class="var">PkA</span>: <span class="type">PK_t</span>,=<span class="fun">SN_CI</span>) = <span class="fun">check_cert</span>(<span class="var">CertA_1</span>,<span class="var">PK_CI</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ100 class="occ">{100}</a> <span class="keyword">if</span> (<span class="fun">hash</span>(<span class="var">HashAlgoB</span>,<span class="fun">Clist2bit</span>(<span class="var">CA_1</span>)) <span class="fun">=</span> <span class="var">hash_CA_1</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ101 class="occ">{101}</a> <span class="keyword">new</span> <span class="name">ChallengeB_1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ102 class="occ">{102}</a> <span class="keyword">new</span> <span class="name">s_1</span>[]: <span class="type">Seed_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ103 class="occ">{103}</a> <span class="keyword">let</span> <span class="var">gx_1</span>: <span class="type">element_t</span> = <span class="fun">dh_pub</span>(<span class="var">g_1</span>,<span class="fun">dh_k</span>(<span class="name">s_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ104 class="occ">{104}</a> <span class="keyword">let</span> <span class="fun"></span>(<span class="var">y</span>: <span class="type">bitstring</span>,<span class="var">gy_DHB_1</span>: <span class="type">element_t</span>) = <span class="fun"></span>(<span class="fun">dh_k</span>(<span class="name">s_1</span>),<span class="var">gx_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ105 class="occ">{105}</a> <span class="keyword">let</span> <span class="var">CB_1</span>: <span class="type">Clist_t</span> = <span class="fun">make_C_list</span>(<span class="var">CertB_1</span>,<span class="var">PermB_1</span>,<span class="var">PdataB_1</span>,<span class="var">DHAlgoB</span>,<span class="var">HashAlgoB</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ106 class="occ">{106}</a> <span class="keyword">let</span> <span class="var">hash_CB_1</span>: <span class="type">bitstring</span> = <span class="fun">hash</span>(<span class="var">HashAlgoB</span>,<span class="fun">Clist2bit</span>(<span class="var">CB_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ107 class="occ">{107}</a> <span class="keyword">let</span> <span class="var">sigB_1</span>: <span class="type">Sig_t</span> = <span class="fun">sign</span>(<span class="var">PrivK_B</span>,<span class="fun"></span>(<span class="var">hash_CB_1</span>,<span class="name">ChallengeB_1</span>,<span class="var">gy_DHB_1</span>,<span class="var">ChallengeA_1</span>,<span class="var">gx_DHA_1</span>,<span class="var">hash_CA_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ108 class="occ">{108}</a> <span class="keyword">event</span> <span class="fun">beginAtoB</span>(<span class="var">GUIDB_2</span>,<span class="var">CertB_1</span>,<span class="var">ChallengeA_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ109 class="occ">{109}</a> <span class="keyword">event</span> <span class="fun">B_0</span>(<span class="var">GUIDB_2</span>,<span class="var">CB_1</span>,<span class="name">ChallengeB_1</span>,<span class="var">gy_DHB_1</span>,<span class="var">GUIDA_2</span>,<span class="var">CA_1</span>,<span class="var">ChallengeA_1</span>,<span class="var">gx_DHA_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ110 class="occ">{110}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">CB_1</span>,<span class="var">hash_CB_1</span>,<span class="var">ChallengeA_1</span>,<span class="name">ChallengeB_1</span>,<span class="var">gy_DHB_1</span>,<span class="var">hash_CA_1</span>,<span class="var">gx_DHA_1</span>,<span class="var">sigB_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ111 class="occ">{111}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(=<span class="var">hash_CA_1</span>,=<span class="var">hash_CB_1</span>,=<span class="var">gx_DHA_1</span>,=<span class="var">gy_DHB_1</span>,=<span class="var">ChallengeA_1</span>,=<span class="name">ChallengeB_1</span>,<span class="var">sigA_1</span>: <span class="type">Sig_t</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ112 class="occ">{112}</a> <span class="keyword">if</span> <span class="fun">verify</span>(<span class="var">PkA</span>,<span class="fun"></span>(<span class="var">hash_CA_1</span>,<span class="var">ChallengeA_1</span>,<span class="var">gx_DHA_1</span>,<span class="name">ChallengeB_1</span>,<span class="var">gy_DHB_1</span>,<span class="var">hash_CB_1</span>),<span class="var">sigA_1</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ113 class="occ">{113}</a> <span class="keyword">event</span> <span class="fun">endBtoA</span>(<span class="var">GUIDA_2</span>,<span class="var">CertA_1</span>,<span class="name">ChallengeB_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ114 class="occ">{114}</a> <span class="keyword">let</span> <span class="var">gxy_SharedSecret_1</span>: <span class="type">element_t</span> = <span class="fun">dh_exp</span>(<span class="var">gx_DHA_1</span>,<span class="var">y</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ115 class="occ">{115}</a> <span class="keyword">let</span> <span class="var">SharedSecret_1</span>: <span class="type">bitstring</span> = <span class="fun">e2b</span>(<span class="var">gxy_SharedSecret_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ116 class="occ">{116}</a> <span class="keyword">event</span> <span class="fun">B_1</span>(<span class="var">GUIDB_2</span>,<span class="var">CB_1</span>,<span class="name">ChallengeB_1</span>,<span class="var">gy_DHB_1</span>,<span class="var">GUIDA_2</span>,<span class="var">CA_1</span>,<span class="var">ChallengeA_1</span>,<span class="var">gx_DHA_1</span>,<span class="var">SharedSecret_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ117 class="occ">{117}</a> <span class="keyword">new</span> <span class="name">Topic_1</span>: <span class="type">TopicID_t</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ118 class="occ">{118}</a> <span class="keyword">event</span> <span class="fun">TOPIC_CRT_REQ</span>(<span class="var">GUIDB_2</span>,<span class="var">PermB_1</span>,<span class="name">Topic_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ119 class="occ">{119}</a> <span class="keyword">out</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">PermB_1</span>,<span class="fun">TopicCreateReq</span>,<span class="name">Topic_1</span>,<span class="var">PdataB_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ120 class="occ">{120}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(=<span class="var">GUIDA_2</span>,=<span class="fun">PermissionChecked</span>,=<span class="var">GUIDB_2</span>,=<span class="name">Topic_1</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ121 class="occ">{121}</a> <span class="keyword">let</span> <span class="var">KeyMaterial_1</span>: <span class="type">KeyMaterial_t</span> = <span class="fun">KDF</span>(<span class="var">SharedSecret_1</span>,<span class="var">ChallengeA_1</span>,<span class="name">ChallengeB_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ122 class="occ">{122}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="var">CryptoToken_1</span>: <span class="type">CryptoToken_t</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ123 class="occ">{123}</a> <span class="keyword">if</span> <span class="fun">decCryptoToken</span>(<span class="var">CryptoToken_1</span>,<span class="var">KeyMaterial_1</span>,<span class="var">DHAlgoB</span>,<span class="var">HashAlgoB</span>,<span class="var">AeadAlgoB</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ124 class="occ">{124}</a> <span class="keyword">new</span> <span class="name">sessionID_1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ125 class="occ">{125}</a> <span class="keyword">new</span> <span class="name">IV_1</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ126 class="occ">{126}</a> <span class="keyword">let</span> <span class="var">cryptoHeader_1</span>: <span class="type">CryptoHeader_t</span> = <span class="fun">makeCryptoHeader</span>(<span class="name">sessionID_1</span>,<span class="name">IV_1</span>) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ127 class="occ">{127}</a> <span class="keyword">let</span> <span class="var">sessionKey_1</span>: <span class="type">bitstring</span> = <span class="fun">hmac</span>(<span class="var">HashAlgoB</span>,<span class="fun">b2mk</span>(<span class="fun">km2b</span>(<span class="var">KeyMaterial_1</span>)),<span class="fun"></span>(<span class="name">sessionID_1</span>,<span class="var">KeyMaterial_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ128 class="occ">{128}</a> <span class="keyword">event</span> <span class="fun">B_2</span>(<span class="var">GUIDB_2</span>,<span class="var">CB_1</span>,<span class="name">ChallengeB_1</span>,<span class="var">gy_DHB_1</span>,<span class="var">GUIDA_2</span>,<span class="var">CA_1</span>,<span class="var">ChallengeA_1</span>,<span class="var">gx_DHA_1</span>,<span class="var">SharedSecret_1</span>,<span class="var">KeyMaterial_1</span>,<span class="var">cryptoHeader_1</span>,<span class="var">sessionKey_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ129 class="occ">{129}</a> <span class="keyword">new</span> <span class="name">applicationData_MAC</span>: <span class="type">bitstring</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ130 class="occ">{130}</a> <span class="keyword">event</span> <span class="fun">B_3</span>(<span class="var">GUIDB_2</span>,<span class="var">GUIDA_2</span>,<span class="name">applicationData_MAC</span>,<span class="var">cryptoHeader_1</span>,<span class="var">sessionKey_1</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ131 class="occ">{131}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">cryptoHeader_1</span>,<span class="fun"></span>(<span class="name">applicationData_MAC</span>,<span class="name">secretData</span>),<span class="fun">aead_mac</span>(<span class="var">AeadAlgoB</span>,<span class="fun">b2ae</span>(<span class="var">sessionKey_1</span>),<span class="name">IV_1</span>,<span class="fun">chtob</span>(<span class="var">cryptoHeader_1</span>),<span class="fun"></span>(<span class="name">applicationData_MAC</span>,<span class="name">secretData</span>))));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ132 class="occ">{132}</a> <span class="keyword">in</span>(<span class="name">RTPS_Ch</span>, <span class="fun"></span>(<span class="var">cryptoHeader_n</span>: <span class="type">CryptoHeader_t</span>,<span class="var">applicationData_x_new</span>: <span class="type">bitstring</span>,<span class="var">applicationDataMAC_new</span>: <span class="type">bitstring</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ133 class="occ">{133}</a> <span class="keyword">let</span> <span class="fun">makeCryptoHeader</span>(<span class="var">sessionID_new_1</span>: <span class="type">bitstring</span>,<span class="var">IV_new_1</span>: <span class="type">bitstring</span>) = <span class="var">cryptoHeader_n</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ134 class="occ">{134}</a> <span class="keyword">if</span> (<span class="var">sessionID_new_1</span> <span class="fun">&lt;&gt;</span> <span class="name">sessionID_1</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ135 class="occ">{135}</a> <span class="keyword">let</span> <span class="var">sessionKey_new_1</span>: <span class="type">bitstring</span> = <span class="fun">hmac</span>(<span class="var">HashAlgoB</span>,<span class="fun">b2mk</span>(<span class="fun">km2b</span>(<span class="var">KeyMaterial_1</span>)),<span class="fun"></span>(<span class="var">sessionID_new_1</span>,<span class="var">KeyMaterial_1</span>)) <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ136 class="occ">{136}</a> <span class="keyword">if</span> <span class="fun">aead_mac_check</span>(<span class="var">AeadAlgoB</span>,<span class="fun">b2ae</span>(<span class="var">sessionKey_new_1</span>),<span class="var">IV_new_1</span>,<span class="fun">chtob</span>(<span class="var">cryptoHeader_n</span>),<span class="var">applicationData_x_new</span>,<span class="var">applicationDataMAC_new</span>) <span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ137 class="occ">{137}</a> <span class="keyword">event</span> <span class="fun">KEY_UPDATE_end</span>(<span class="var">GUIDA_2</span>,<span class="var">GUIDB_2</span>,<span class="var">cryptoHeader_n</span>,<span class="var">sessionKey_new_1</span>,<span class="var">applicationData_x_new</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ138 class="occ">{138}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="name">finishB</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ139 class="occ">{139}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="name">finishB</span>)<br>
) | (<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ140 class="occ">{140}</a> <span class="keyword">!</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ141 class="occ">{141}</a> <span class="keyword">let</span> <span class="var">Topic_bd_3</span>: <span class="type">TopicID_t</span> = <span class="name">Topic_bd</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ142 class="occ">{142}</a> <span class="keyword">in</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">GUIDB_3</span>: <span class="type">GUID_t</span>,<span class="var">PdataB_2</span>: <span class="type">Pdata_t</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ143 class="occ">{143}</a> <span class="keyword">let</span> <span class="fun">participant_data</span>(=<span class="var">GUIDB_3</span>,=<span class="var">Topic_bd_3</span>,<span class="var">QosB_2</span>: <span class="type">Qos_t</span>,=<span class="fun">discoveryRegister</span>) = <span class="var">PdataB_2</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ144 class="occ">{144}</a> <span class="keyword">in</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">GUIDA_3</span>: <span class="type">GUID_t</span>,<span class="var">PdataA_2</span>: <span class="type">Pdata_t</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ145 class="occ">{145}</a> <span class="keyword">let</span> <span class="fun">participant_data</span>(=<span class="var">GUIDA_3</span>,=<span class="var">Topic_bd_3</span>,<span class="var">QosA</span>: <span class="type">Qos_t</span>,=<span class="fun">discoveryRegister</span>) = <span class="var">PdataA_2</span> <span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ146 class="occ">{146}</a> <span class="keyword">event</span> <span class="fun">DISCOVERY</span>(<span class="var">GUIDB_3</span>,<span class="var">PdataB_2</span>,<span class="var">GUIDA_3</span>,<span class="var">PdataA_2</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ147 class="occ">{147}</a> <span class="keyword">out</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">PdataB_2</span>,<span class="fun">discoveredParticipant</span>,<span class="var">PdataA_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ148 class="occ">{148}</a> <span class="keyword">in</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">PermB_2</span>: <span class="type">PermDoc_t</span>,=<span class="fun">TopicCreateReq</span>,<span class="var">Topic_2</span>: <span class="type">TopicID_t</span>,=<span class="var">PdataB_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ149 class="occ">{149}</a> <span class="keyword">event</span> <span class="fun">TOPIC_DISCOVERED</span>(<span class="var">GUIDB_3</span>,<span class="var">PermB_2</span>,<span class="var">Topic_2</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ150 class="occ">{150}</a> <span class="keyword">out</span>(<span class="name">Discovery_ch</span>, <span class="fun"></span>(<span class="var">PermB_2</span>,<span class="fun">TopicDiscovered</span>,<span class="var">Topic_2</span>,<span class="var">PdataB_2</span>));<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a name=occ151 class="occ">{151}</a> <span class="keyword">out</span>(<span class="name">RTPS_Ch</span>, <span class="name">finishDiscovery</span>)<br>
)<br>
<br>
</body>
</html>
